# Горец-2025
## Документация, Воробьев Артём, тг: @V_Arterics



Пересобранный Горец с использованием aiogram и sqlalchemy+sqlite для хранения данных

- models.py db.py - описание таблиц и функции БД
- main.py - вся логика телеграм бота 
- qr_generation.py - генерация QR 
- config_reader.py admin.py - настройка бота
- texts.py requirements.py - тексты для отправки боту и используемые библиотеки

## models.py

В нём через ООП описываются таблицы для БД.

Каждый класс - своя таблица

Стандартный класс Base содержит в себе колонку порядкового номера для БД, следует каждый новый класс наследовать от него

Атрибут __tablename__ отвечает за название таблицы (не путать с названием класса, в ForeignKey пишем именно название таблицы!)

Каждые колонки объявляются по следующему принципу:  ИМЯ: Mapped[тип_данных] = mapped_column(...)

В скобках указываем либо наследуемую колонку, либо класс типа данных, если это String, то дополнительно указываем кол-во символов

как писал выше, если мы хотим унаследовать класс, пишем: ForeignKey("название_таблицы.название_колонки")


## db.py

Тут через sqlalchemy в связке с SQLite и асинхронным программированием описываются функции БД
Здесь уже всё зависит от задачи, поэтому снизу опишу важные моменты, которые могут помочь

- в каждую функцию передается параметр db: AsyncSession, это сессия БД, без нее вы не сможете что-либо сделать с ней
- не забывайте после изменений БД писать db.commit() иначе ничего не сохранится!
- способ возвращать скаляр объектов довольно гибкий, можно вернуть ВСЕ найденные объекты, один, один ИЛИ None, все ИЛИ None. С ними стоит быть осторожными, настоятельно рекомендую прописывать, какая функция какой тип данных должна вернуть, иначе может быть ошибка, которую будет сложно найти. Я говорю про моменты, когда вы думаете, что возвращается список, а там None или наоборот. 
- Прошлая версия Горца использовала списки, а не классы, для хранения данных объекта из БД. Просто информация, которую стоит знать, если будете пользоваться обоими версиями.


## main.py

Здесь я добавил новые механники с QR кодами и подтверждениями, а в остальном изменил вводы выводы функций под sqlalchemy 
Всё что могу сказать, отмечайте в каждой функции типы данных, не пожалеете.

В случае надобности новой проверки, параметра или статуса, добавьте новый класс наследуемый от StateGroup и опишите в нём нужные состояния.

Диспетчер отвечает за вызов функции, 2 основных "тригера" вызова функции это сообщение-команда (message) и callback
В зависимости от вызова вы берете user.id либо из message.from_user.id, либо из callback.from_user.id

Также нек-е сообщения написаны в main.py, а не texts.py


## qr_generating.py

Для генерации QR не забудьте создать папку ./QR 
В функции можно выбрать размер, цвет и т.д.

Также я сделал генератор всевозможных комбинаций слов из существительного, прилагательного и дополнения

Это сделано для того, чтобы нельзя было перебором угадать код-слово игрока

Перед запуском прода следует один раз запустить этот файл и больше не трогать.

Если нужно изменить что-то, лучше полностью удалить сгенерированные QR коды и перезапустить измененный код

## установка библиотек
```sh
pip install -r requirements.txt
```

На этом всё, в документации могут быть ошибки, и в коде тоже, так что будьте начеку! По каким-то вопросам по коду можно попробовать написать мне (если тг будет существовать к этому моменту). Удачи, профкомовец!
